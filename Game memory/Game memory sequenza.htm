<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memory Sequenziale</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEJ07Xr5zH9W1M4uQp3PD84c8x6QQwJeY9he0wHZtZ7e0gRkWojcHpOH41zFH" crossorigin="anonymous">
  <style>
    .button-light {
      background-color: #007bff;
    }
    .button-dim {
      background-color: #6c757d;
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 20px;
      max-width: 500px;
      margin: 0 auto;
    }
    .btn {
      height: 100px;
      width: 100px;
      font-size: 24px;
    }
    .message {
      margin-top: 20px;
      font-size: 20px;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container text-center">
    <h1 class="my-4">Gioco Memory Sequenziale</h1>
    <button id="startBtn" class="btn btn-primary btn-lg mb-4">Inizia</button>
    <div class="grid-container" id="grid">
      <!-- Pulsanti dinamici -->
    </div>
    <div class="message" id="message"></div>
    <div id="score" class="my-3">Punteggio: 0</div>
  </div>

  <!-- Bootstrap 5 JS e dipendenze -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz4fnFO9gybF7rDfjfS6j7kS2me8FE6F2knlN/8X73hxj4NO4gDkR3sZ48" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-pzjw8f+ua7Kw1TIq0bYkK0xhrv5A2+G6I9R5PbbYce5Afoyfd3yD7T97tdf7p8a9" crossorigin="anonymous"></script>
  <script>
    let sequence = [];
    let userSequence = [];
    let score = 0;
    let gameActive = false;

    // Riferimenti agli elementi HTML
    const grid = document.getElementById('grid');
    const startBtn = document.getElementById('startBtn');
    const message = document.getElementById('message');
    const scoreDisplay = document.getElementById('score');

    // Impostazione della griglia dei pulsanti
    function createGrid(rows = 4, cols = 4) {
      grid.innerHTML = ''; // Pulisce la griglia
      for (let i = 0; i < rows * cols; i++) {
        const button = document.createElement('button');
        button.classList.add('btn', 'btn-light', 'button-dim');
        button.dataset.index = i;  // Aggiungi l'indice per riferimento
        button.addEventListener('click', () => handleUserInput(i));
        grid.appendChild(button);
      }
    }

    // Avvio del gioco
    startBtn.addEventListener('click', startGame);

    function startGame() {
      gameActive = true;
      score = 0;
      sequence = [];
      userSequence = [];
      scoreDisplay.textContent = `Punteggio: ${score}`;
      message.textContent = "Memorizza la sequenza!";
      createGrid();  // Crea la griglia
      nextRound();
    }

    // Genera il prossimo turno
    function nextRound() {
      userSequence = [];
      sequence.push(Math.floor(Math.random() * 16)); // Aggiunge un nuovo pulsante alla sequenza
      showSequence(sequence);
    }

    // Mostra la sequenza di pulsanti
    function showSequence(seq) {
      let index = 0;
      const interval = setInterval(() => {
        const btn = grid.children[seq[index]];
        btn.classList.add('button-light');
        setTimeout(() => {
          btn.classList.remove('button-light');
        }, 500);
        index++;

        if (index === seq.length) {
          clearInterval(interval);
          enableUserInput(true);
        }
      }, 1000);
    }

    // Abilita o disabilita l'input dell'utente
    function enableUserInput(enable) {
      const buttons = grid.children;
      for (let button of buttons) {
        button.disabled = !enable;
      }
    }

    // Gestisce l'input dell'utente
    function handleUserInput(index) {
      if (!gameActive) return;

      userSequence.push(index);
      const correct = userSequence.length === sequence.length && 
                      userSequence.every((val, i) => val === sequence[i]);

      if (correct) {
        if (userSequence.length === sequence.length) {
          score++;
          scoreDisplay.textContent = `Punteggio: ${score}`;
          message.textContent = "Hai indovinato, prossimo turno!";
          setTimeout(nextRound, 1000);
        }
      } else {
        message.textContent = "Hai sbagliato! Gioco finito.";
        gameActive = false;
      }
    }
  </script>
</body>
</html>
